{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/6886b73e-c81e-4637-beb7-c407f3b1f8d9",
    "name":  "6886b73e-c81e-4637-beb7-c407f3b1f8d9",
    "etag":  "\"870047e0-0000-2700-0000-66fdca860000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT5H",
                       "queryPeriod":  "PT5H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "Medium",
                       "query":  "//Description: GraphRunner is a post-exploitation toolset for interacting with the Microsoft Graph API. It provides various tools for performing reconnaissance, persistence, and pillaging of data from a Microsoft Entra ID (Azure AD) account.\n//Author: Michael gibbs\n//False Positives: Administrative users using powershell listed below in daily use. If so would recommend commenting out that module.\nlet Cmdlets = dynamic([\"Get-GraphToken\", \n                       \"Invoke-GraphRecon\", \n                       \"Invoke-GraphRunner\", \n                       \"Invoke-GraphOpenInboxFinder\", \n                       \"Get-SharePointSiteURLs\", \n                       \"Get-DynamicGroups\", \n                       \"Get-UpdatableGroups\", \n                       \"Invoke-DumpApps\", \n                       \"Get-SecurityGroups\", \n                       \"Get-AzureADUsers\", \n                       \"Invoke-InjectOAuthApp\", \n                       \"Invoke-SecurityGroupCloner\", \n                       \"Invoke-InviteGuest\", \n                       \"Invoke-AddGroupMember\", \n                       \"Invoke-SearchSharePointAndOneDrive\", \n                       \"Invoke-ImmersiveFileReader\", \n                       \"Invoke-SearchMailbox\", \n                       \"Invoke-SearchTeams\", \n                       \"Invoke-SearchUserAttributes\", \n                       \"Get-Inbox\", \n                       \"Get-TeamsChat\", \n                       \"Invoke-DeleteOAuthApp\", \n                       \"Invoke-DeleteGroup\", \n                       \"Invoke-RemoveGroupMember\", \n                       \"Invoke-DriveFileDownload\", \n                       \"Invoke-CheckAccess\", \n                       \"Get-UserObjectID\"]);\nlet signInLookup = (\nSigninLogs\n|where TimeGenerated\u003e=ago(1d)\n|where DeviceDetail contains \"displayName\"\n|extend DeviceDetailJson=parse_json(DeviceDetail)\n|extend DeviceNameSI=tostring(DeviceDetailJson.displayName)\n|distinct DeviceNameSI,UserPrincipalName,UserDisplayName, UserId\n);\nDeviceEvents\n| where AdditionalFields has_any (Cmdlets)\n|extend SILogDeviceName=toupper((split(DeviceName,\".\"))[0])\n|join kind=leftouter signInLookup on $left.SILogDeviceName==$right.DeviceNameSI\n|project TimeGenerated, AdditionalFields.Command,InitiatingProcessAccountDomain,InitiatingProcessAccountName,UserDisplayName",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  null,
                                                                                   "groupByCustomDetails":  null
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Name",
                                                                            "columnName":  "UserDisplayName"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "Persistence",
                                       "Collection"
                                   ],
                       "techniques":  [
                                          "T1556",
                                          "T0802"
                                      ],
                       "displayName":  "BAH_GRAPHRUNNER",
                       "enabled":  true,
                       "description":  "GraphRunner is a post-exploitation toolset for interacting with the Microsoft Graph API. It provides various tools for performing reconnaissance, persistence, and pillaging of data from a Microsoft Entra ID (Azure AD) account.\n\nIt consists of three separate parts:\n\nA PowerShell script where the majority of modules are located\nAn HTML GUI that can leverage an access token to navigate and pillage a user\u0027s account\nA simple PHP redirector for harvesting authentication codes during an OAuth flow\nPLATFORM:ICS,Windows\nMITRE:TA0003;T1556,TA0100;T0802",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:34:43.226349Z"
                   }
}
