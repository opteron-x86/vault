{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/ac89200a-8386-49c9-bf0e-7e1782b2ddf9",
    "name":  "ac89200a-8386-49c9-bf0e-7e1782b2ddf9",
    "etag":  "\"5b01acb8-0000-2700-0000-66bbb17d0000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT1H",
                       "queryPeriod":  "PT1H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "High",
                       "query":  "SigninLogs\r\n//filter on Microsoft 2FA Authenticator errors\r\n| where ResultType == 500121\r\n//Parse the authentication details so we can query the data\r\n| extend AuthResult = tostring(parse_json(AuthenticationDetails)[1].authenticationStepResultDetail)\r\n//Collect all denied or ignored MFA requests\r\n| where AuthResult in (\"MFA denied; user declined the authentication\", \"MFA denied; user did not respond to mobile app notification\") or Status has \"MFA denied; Phone App Reported Fraud\"\r\n//Enable the below two filters if you have Conditional Access configured\r\n//| where parse_json(AuthenticationDetails)[1].authenticationStepRequirement == \"User, MultiConditionalAccess\"\r\n//| where isnotempty(AlternateSignInName)\r\n//Count all denied and ignored alerts within a 12 hour time-frame\r\n| summarize [\u0027MFA_Actions\u0027]=make_list(AuthResult), [\u0027MFATotalFailed\u0027]=count() by AppDisplayName, Identity, UserPrincipalName, bin(TimeGenerated, 12h)\r\n//Detect MFA bombing (\u003e3) denied or ignored MFA tokens\r\n| where [\u0027MFATotalFailed\u0027] \u003e 3\r\n| sort by MFATotalFailed\r\n//Order the output in a logical order\r\n| project TimeGenerated, Identity, UserPrincipalName, AppDisplayName, MFA_Actions, MFATotalFailed",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5H",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  [

                                                                                                           ],
                                                                                   "groupByCustomDetails":  [

                                                                                                            ]
                                                                               }
                                                 },
                       "customDetails":  {

                                         },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "UserPrincipalName"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "CredentialAccess"
                                   ],
                       "techniques":  [
                                          "T1110"
                                      ],
                       "displayName":  "DEOS_CTH_Possible IAM MFA bombing from Microsoft 2FA notifications",
                       "enabled":  true,
                       "description":  "\"MFA bombing,\" also known as \"MFA fatigue\" or \"MFA spamming,\" is a cyberattack method where an attacker bombards a user with multiple multi-factor authentication (MFA) prompts in rapid succession. The goal is to frustrate or fatigue the user into eventually approving the request, granting the attacker access to the system. This technique is often used in combination with stolen credentials to bypass security measures, and it exploits human error rather than technical vulnerabilities. \n\nThe appropriate threshold can vary depending on your organization\u0027s typical activity levels but commonly ranges from 3 to 5 requests within a short period, such as 5 to 10 minutes. DEOS CTH will monitor and adjust this based on normal behavior and organizational needs. Majority of the activity observed will occur with service accounts not signing in with a CAC. Threshold has been updated to greater than 5 effective 8.13.24 by Brandon Conn of DEOS IR Team.\n\nhttps://cryptsus.com/blog/azure-mfa-bombing-detection-sentinel.html",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-08-13T19:18:19.5878035Z"
                   }
}
