{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/fda6eac4-5171-48ce-9fa1-a0be364ecc7b",
    "name":  "fda6eac4-5171-48ce-9fa1-a0be364ecc7b",
    "etag":  "\"88002c0e-0000-2700-0000-66fdcd840000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT1H",
                       "queryPeriod":  "PT1H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "High",
                       "query":  "//Title: BAH_AkiraRansomware\n// Author: Steven Wan\n// Description: Akira ransomware threat actors deploy and focus on targeting Linux variant VMware ESXi virtual machines. Akira threat actors will launch their attacks using both Megazord (a Rust-based code) and Akira (written in C++).\n// Additional Details: [https://www.cisa.gov/news-events/alerts/2024/04/18/cisa-and-partners-release-advisory-akira-ransomware]\n// False Positives: N/A\n\nlet hashlist = dynamic([\u0027d2fd0654710c27dcf37b6c1437880020824e161dd0bf28e3a133ed777242a0ca\u0027,\n\u0027dcfa2800754e5722acf94987bb03e814edcb9acebda37df6da1987bf48e5b05e\u0027,\n\u0027bc747e3bf7b6e02c09f3d18bdd0e64eef62b940b2f16c9c72e647eec85cf0138\u0027,\n\u002773170761d6776c0debacfbbc61b6988cb8270a20174bf5c049768a264bb8ffaf\u0027,\n\u00271b60097bf1ccb15a952e5bcc3522cf5c162da68c381a76abc2d5985659e4d386\u0027,\n\u0027aaa647327ba5b855bedea8e889b3fafdc05a6ca75d1cfd98869432006d6fecc9\u0027,\n\u00277d6959bb7a9482e1caa83b16ee01103d982d47c70c72fdd03708e2b7f4c552c4\u0027,\n\u00273298d203c2acb68c474e5fdad8379181890b4403d6491c523c13730129be3f75\u0027,\n\u00270ee1d284ed663073872012c7bde7fac5ca1121403f1a5d2d5411317df282796c\u0027,\n\u0027ffd9f58e5fe8502249c67cad0123ceeeaa6e9f69b4ec9f9e21511809849eb8fc\u0027,\n\u0027dfe6fddc67bdc93b9947430b966da2877fda094edf3e21e6f0ba98a84bc53198\u0027,\n\u0027131da83b521f610819141d5c740313ce46578374abb22ef504a7593955a65f07\u0027,\n\u00279f393516edf6b8e011df6ee991758480c5b99a0efbfd68347786061f0e04426c\u0027,\n\u00279585af44c3ff8fd921c713680b0c2b3bbc9d56add848ed62164f7c9b9f23d065\u0027,\n\u00272f629395fdfa11e713ea8bf11d40f6f240acf2f5fcf9a2ac50b6f7fbc7521c83\u0027,\n\u00277f731cc11f8e4d249142e99a44b9da7a48505ce32c4ee4881041beeddb3760be\u0027,\n\u002795477703e789e6182096a09bc98853e0a70b680a4f19fa2bf86cbb9280e8ec5a\u0027,\n\u00270c0e0f9b09b80d87ebc88e2870907b6cacb4cd7703584baf8f2be1fd9438696d\u0027,\n\u0027C9c94ac5e1991a7db42c7973e328fceeb6f163d9f644031bdfd4123c7b3898b0\u0027,\n\u0027aaa6041912a6ba3cf167ecdb90a434a62feaf08639c59705847706b9f492015d\u0027,\n\u002718051333e658c4816ff3576a2e9d97fe2a1196ac0ea5ed9ba386c46defafdb88\u0027,\n\u00275e1e3bf6999126ae4aa52146280fdb913912632e8bac4f54e98c58821a307d32\u0027,\n\u00278317ff6416af8ab6eb35df3529689671a700fdb61a5e6436f4d6ea8ee002d694\u0027,\n\u0027892405573aa34dfc49b37e4c35b655543e88ec1c5e8ffb27ab8d1bbf90fc6ae0\u0027\n]);\nlet signInLookup = (\nSigninLogs\n| where TimeGenerated \u003e= ago(1d)\n| where DeviceDetail contains \"displayName\"\n| extend DeviceDetailJson = parse_json(DeviceDetail)\n| extend DeviceNameSI = tostring(DeviceDetailJson.displayName)\n| distinct DeviceNameSI, UserPrincipalName\n);\n(union isfuzzy=True\n    (\n    union withsource=TableName Device* //looks at any table titled \"Device\"\n    | where SHA256 has_any (hashlist)  //checks for any SHA256 in the hashlist\n    | extend SILogDeviceName = toupper((split(DeviceName, \".\"))[0])\n    | join kind=leftouter signInLookup on $left.SILogDeviceName == $right.DeviceNameSI\n    )\n| project TimeGenerated, AccountName, UserPrincipalName, FileName, FileOriginIP, SHA256, MD5, DeviceName\n)",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  null,
                                                                                   "groupByCustomDetails":  null
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "FileHash",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Value",
                                                                            "columnName":  "SHA256"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Name",
                                                                            "columnName":  "UserPrincipalName"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "Host",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "DeviceName"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "File",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Name",
                                                                            "columnName":  "FileName"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "InitialAccess",
                                       "Persistence",
                                       "DefenseEvasion",
                                       "Exfiltration"
                                   ],
                       "techniques":  [
                                          "T1190",
                                          "T1133",
                                          "T1566",
                                          "T1078",
                                          "T1136"
                                      ],
                       "displayName":  "BAH_AkiraRansomware",
                       "enabled":  true,
                       "description":  "Akira ransomware threat actors deploy and focus on targeting Linux variant VMware ESXi virtual machines. Akira threat actors will launch their attacks using both Megazord (a Rust-based code) and Akira (written in C++).\nPLATFORM:IaaS,Microsoft 365,Linux,Azure AD\nMITRE:TA0001;T1078;T1133;T1190;T1566,TA0003;T1078;T1133;T1136,TA0005;T1078",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:47:31.6296728Z"
                   }
}
