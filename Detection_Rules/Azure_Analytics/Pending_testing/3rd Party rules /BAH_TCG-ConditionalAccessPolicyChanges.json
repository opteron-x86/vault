{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/e8b722d1-4ed7-478c-a1be-fa89d1722152",
    "name":  "e8b722d1-4ed7-478c-a1be-fa89d1722152",
    "etag":  "\"8700fea3-0000-2700-0000-66fdc64a0000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT5M",
                       "queryPeriod":  "PT5M",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "High",
                       "query":  "//Author: Stephen Rowley\r\n//Description: A series of conditional access policies are configured upon initial tenant configuration. These should either never change or only be changed rarely and likely never deleted. This analytic will look for update and delete operations to a list of conditional access policies. The prefix \"TCG-\" is used to target the policies by displayname.\r\n//False Positives: Can alert on legitimate changes to conditional access policies, but should still be investigated to confirm as these changes should be rare.\r\nAuditLogs\r\n| where OperationName in (\u0027Update policy\u0027, \u0027Delete policy\u0027)\r\n| where Category == \"Policy\"\r\n| extend initiatedByUser = parse_json(InitiatedBy).user.userPrincipalName\r\n| mv-apply CAPolicyName = todynamic(TargetResources) on (where CAPolicyName has \"displayName\" | extend CAPolicyName = CAPolicyName[\u0027displayName\u0027])\r\n| where CAPolicyName startswith \"TCG\" or CAPolicyName startswith \"v2-TCG\"\r\n| summarize CAPolicyName = make_list(CAPolicyName, 10) by TimeGenerated, tostring(initiatedByUser), OperationName, Result\r\n//MITRE\r\n//Defense Evasion TA0005\r\n//Impair Defenses T1562\r\n//Modify Authentication Process T1556",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5H",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  [

                                                                                                           ],
                                                                                   "groupByCustomDetails":  [

                                                                                                            ]
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "AadUserId",
                                                                            "columnName":  "initiatedByUser"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "AzureResource",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "ResourceId",
                                                                            "columnName":  "CAPolicyName"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "DefenseEvasion"
                                   ],
                       "techniques":  [
                                          "T1556",
                                          "T1562"
                                      ],
                       "displayName":  "BAH_TCG-ConditionalAccessPolicyChanges",
                       "enabled":  true,
                       "description":  "A series of conditional access policies are configured upon initial tenant configuration. These should either never change or only be changed rarely and likely never deleted. This analytic will look for update and delete operations to a list of conditional access policies. The prefix \"TCG-\" is used to target the policies by displayname.\n\nModify Authentication Process (T1556), Impair Defenses(T1562): T1562.001\nPLATFORM:Azure AD,Windows,Microsoft 365\nMITRE:TA0005;T1556;T1556.006;T1556.007;T1562",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:16:41.3339334Z"
                   }
}
