{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/c50669fe-9030-4e19-8016-26f79e43823b",
    "name":  "c50669fe-9030-4e19-8016-26f79e43823b",
    "etag":  "\"8700e4b0-0000-2700-0000-66fdc7340000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT5H",
                       "queryPeriod":  "PT5H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "Medium",
                       "query":  "//Author: Michael Gibbs \n//Description: Looks at admin user deletion greater than 50, Ransomware as a service is greater than 50 and intended for persistence and data exfiltration.\n//False Positives: Mass deletion of users due to page no longer being active \nlet signInLookup=(\nSigninLogs\n|where TimeGenerated\u003e=ago(1d)\n|where DeviceDetail contains \"displayName\"\n|extend DeviceDetailJson=parse_json(DeviceDetail)\n|extend DeviceNameSI=tostring(DeviceDetailJson.displayName)\n|distinct DeviceNameSI,UserPrincipalName,UserDisplayName, UserId\n);\nlet interesting=(\nOfficeActivity\n| where Operation == \"SiteCollectionAdminRemoved\"\n|where TimeGenerated\u003e=ago(1d)\n| where RecordType contains \"SharePoint\"\n| where OfficeWorkload == \"SharePoint\"\n| where UserId != @\"app@sharepoint\"\n| summarize Count = count() by Site_Url, UserId\n| where Count \u003e 50\n| join kind=leftouter signInLookup on $left.UserId == $right.UserPrincipalName\n);\ninteresting\n| where DeviceNameSI != \"\"\n| project Count, UserId, Site_Url, DeviceNameSI\n",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  null,
                                                                                   "groupByCustomDetails":  null
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Host",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "HostName",
                                                                            "columnName":  "DeviceNameSI"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Name",
                                                                            "columnName":  "UserId"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "Collection"
                                   ],
                       "techniques":  [
                                          "T1213"
                                      ],
                       "displayName":  "BAH_SHAREPOINT_ADMIN_USER_DELETION",
                       "enabled":  true,
                       "description":  "MITRE ATT\u0026CK Technique T1213.002, ???SharePoint - User Deletion??? Adversaries may leverage information repositories to mine valuable information. Information repositories are tools that allow for storage of information, typically to facilitate collaboration or information sharing between users, and can store a wide variety of data that may aid adversaries in further objectives, or direct access to the target information. Adversaries may also abuse external sharing features to share sensitive documents with recipients outside of the organization.\nThe focus was to conduct a thorough investigation on Activity logs. This will help identify patterns, uncover anomalies, and gather evidence to determine if there is a real threat of unauthorized user deletion activities within the SharePoint environment.\nPLATFORM:Microsoft 365,Windows,IaaS\nMITRE:TA0009;T1213;T1213.002",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:20:33.4978864Z"
                   }
}
