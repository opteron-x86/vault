{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/0f919bbd-7307-48ce-a603-b25052495b3d",
    "name":  "0f919bbd-7307-48ce-a603-b25052495b3d",
    "etag":  "\"8700c7ff-0000-2700-0000-66fdcc7b0000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT1H",
                       "queryPeriod":  "PT1H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "Medium",
                       "query":  "// Author: Rob Russell\n// Description: searches for activity related to the CISA report on Conti related domains\n// see https://www.cisa.gov/uscert/ncas/alerts/aa21-265a\n// since Conti uses a wide gambit of tools, no MITRE tactics are associates with this analytic\n// the following regex will also capture these domains and others that are similarly structured \n// (([b-df-hj-np-tv-zB-DF-HJ-NP-TV-Z][aAeEiIoOuU]){2,4})[b-df-hj-np-tv-zB-DF-HJ-NP-TV-Z]*\\.com\n// False Positives: Attackers often change the domains they use, some of these domains may no longer be under Conti control\nlet ContiDomains = dynamic([\"badiwaw.com\", \"balacif.com\", \"barovur.com\", \"basisem.com\", \"bimafu.com\", \"bujoke.com\", \"buloxo.com\", \"bumoyez.com\", \"bupula.com\", \"cajeti.com\", \"cilomum.com\", \"codasal.com\", \"comecal.com\", \"dawasab.com\", \"derotin.com\", \"dihata.com\", \"dirupun.com\", \"dohigu.com\", \"dubacaj.com\", \"fecotis.com\", \"fipoleb.com\", \"fofudir.com\", \"fulujam.com\", \"ganobaz.com\", \"gerepa.com\", \"gucunug.com \", \"guvafe.com\", \"hakakor.com\", \"hejalij.com\", \"hepide.com\", \"hesovaw.com\", \"hewecas.com\", \"hidusi.com\", \"hireja.com\", \"hoguyum.com\", \"jecubat.com\", \"jegufe.com\", \"joxinu.com\", \"kelowuh.com\", \"kidukes.com\", \"kipitep.com\", \"kirute.com\", \"kogasiv.com\", \"kozoheh.com\", \"kuxizi.com\", \"kuyeguh.com\", \"lipozi.com\", \"lujecuk.com\", \"masaxoc.com\", \"mebonux.com\", \"mihojip.com\", \"modasum.com\", \"moduwoj.com\", \"movufa.com\", \"nagahox.com\", \"nawusem.com\", \"nerapo.com\", \"newiro.com\", \"paxobuy.com\", \"pazovet.com\", \"pihafi.com\", \"pilagop.com\", \"pipipub.com\", \"pofifa.com\", \"radezig.com\", \"raferif.com\", \"ragojel.com\", \"rexagi.com\", \"rimurik.com\", \"rinutov.com\", \"rusoti.com\", \"sazoya.com\", \"sidevot.com\", \"solobiv.com\", \"sufebul.com\", \"suhuhow.com\", \"sujaxa.com\", \"tafobi.com \", \"tepiwo.com\", \"tifiru.com\", \"tiyuzub.com\", \"tubaho.com\", \"vafici.com\", \"vegubu.com\", \"vigave.com\", \"vipeced.com\", \"vizosi.com\", \"vojefe.com\", \"vonavu.com\", \"wezeriw.com\", \"wideri.com\", \"wudepen.com\", \"wuluxo.com\", \"wuvehus.com\", \"wuvici.com\", \"wuvidi.com\", \"xegogiv.com\", \"xekezix.com\"]);\nDeviceNetworkEvents\n| where isnotempty(RemoteUrl)\n| where RemoteUrl has_any (ContiDomains)\n| project Type, TimeGenerated, DeviceName, RemoteIP, RemoteUrl, InitiatingProcessAccountName\n| extend timestamp = TimeGenerated, HostCustomEntity = DeviceName , AccountCustomEntity = InitiatingProcessAccountName, DNSName = RemoteUrl, IPCustomEntity = RemoteIP",
                       "suppressionDuration":  "PT1H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  null,
                                                                                   "groupByCustomDetails":  null
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "AccountCustomEntity"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "Host",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "HostCustomEntity"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "IP",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Address",
                                                                            "columnName":  "IPCustomEntity"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "Execution",
                                       "DefenseEvasion",
                                       "Discovery"
                                   ],
                       "techniques":  [
                                          "T1059",
                                          "T1140",
                                          "T1018",
                                          "T1016"
                                      ],
                       "displayName":  "BAH_Conti_Domains",
                       "enabled":  true,
                       "description":  "searches for activity related to the CISA report on Conti related domains\nsee https://www.cisa.gov/sites/default/files/publications/AA21-265A-Conti_Ransomware_TLP_WHITE.pdf\nsince Conti uses a wide gambit of tools, no MITRE tactics are associates with this analytic\nthe following regex will also capture these domains and others that are similarly structured \n(([b-df-hj-np-tv-zB-DF-HJ-NP-TV-Z][aAeEiIoOuU]){2,4})[b-df-hj-np-tv-zB-DF-HJ-NP-TV-Z]*\\.com\n\nPLATFORM:Microsoft 365,Azure AD,IaaS,Windows\nMITRE:TA0002;T1059,TA0005;T1140,TA0007;T1016;T1018",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:43:06.5700419Z"
                   }
}
