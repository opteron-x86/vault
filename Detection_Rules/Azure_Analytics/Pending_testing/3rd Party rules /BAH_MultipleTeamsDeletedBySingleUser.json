{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/a63bd61e-9b04-496d-9cf2-1df45eb76601",
    "name":  "a63bd61e-9b04-496d-9cf2-1df45eb76601",
    "etag":  "\"87004fc3-0000-2700-0000-66fdc8720000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "P1D",
                       "queryPeriod":  "P1D",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "Low",
                       "query":  "//Title: BAH_MultipleTeamsDeletedBySingleUser\n//Description: This analytic looks for attempts where multiple teams are deleted by a single user. This is typically unusual behavior that is worth investigating further into for any intrusion attacks/attempts.\n//Author: Steven Wan\n//False Positives: Possible if the threshold for uncommon activity/actions is exceeded. UEBA table is being leveraged here to determine if the activity for multiple Teams being deleted at a time is highly unregular and unusual activity that must be investigated further into with the current threshold set at 5.\n\n// Adjust this value to change how many Teams should be deleted before including\nlet min_delete_count = 5;\nlet BA = (BehaviorAnalytics\n| evaluate bag_unpack(UsersInsights, columnsConflict=\"replace_source\")\n| evaluate bag_unpack(ActivityInsights, columnsConflict=\"replace_source\")\n| extend UserId = tostring(UserPrincipalName)\n| where InvestigationPriority \u003e= 4//adjust threshold\n| extend ActionUncommonlyPerformedByUser = column_ifexists(\"ActionUncommonlyPerformedByUser\",\"\")\n| where ActionUncommonlyPerformedByUser == \"True\"\n| extend AccountObjectID = column_ifexists(\"AccountObjectID\",\"\")\n| extend AccountDomain = column_ifexists(\"AccountDomain\",\"\")\n| extend OnPremisesSID = column_ifexists(\"AccountObjectID\",\"\")\n| extend Resource = column_ifexists(\"Resource\",\"\")\n| extend App = column_ifexists(\"App\",\"\")\n| project-away AccountObjectID,ActionType,ActivityType,TimeProcessed, UserPrincipalName,UserName,EventSource,DevicesInsights,Type,AccountDomain, OnPremisesSID,Resource,App,TenantId,SourceRecordId);\nOfficeActivity\n| where OfficeWorkload =~ \"MicrosoftTeams\" \n| where Operation =~ \"TeamDeleted\"\n| where UserId !has \"Microsoft Teams Sync\"\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), DeletedTeams = make_set(TeamName) by UserId\n| where array_length(DeletedTeams) \u003e min_delete_count\n| extend timestamp = StartTime, AccountCustomEntity = UserId\n| join kind=inner (BA) on $left.UserId==$right.UserId",
                       "suppressionDuration":  "PT1H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  [

                                                                                                           ],
                                                                                   "groupByCustomDetails":  [

                                                                                                            ]
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "AccountCustomEntity"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "Impact"
                                   ],
                       "techniques":  [
                                          "T1485",
                                          "T1489"
                                      ],
                       "displayName":  "BAH_MultipleTeamsDeletedBySingleUser",
                       "enabled":  true,
                       "description":  "This detection flags the occurrences of deleting multiple teams within an hour.\nThis data is a part of Office 365 Connector in Microsoft Sentinel.\nPLATFORM:Windows,IaaS\nMITRE:TA0040;T1485;T1489",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:25:33.260009Z"
                   }
}
