{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/6aa38a39-dbb8-4323-9d6e-33ceacfdb22f",
    "name":  "6aa38a39-dbb8-4323-9d6e-33ceacfdb22f",
    "etag":  "\"8700349f-0000-2700-0000-66fdc5fa0000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT1H",
                       "queryPeriod":  "PT1H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "High",
                       "query":  "//Author: Stephen Rowley\n//Description: A default OWA mailbox policy is configured for the entire tenant that permits certain functions in Outlook Web App. This analytic monitors any event in which the policy is changed or deleted.\n//False Positives: Can alert on legitimate activity, but should be investigated to confirm as these changes should rarely happen.\nOfficeActivity\n| where Operation in (\u0027Set-OwaMailboxPolicy\u0027, \u0027Remove-OwaMailboxPolicy\u0027)\n| where not(UserId contains \"NT AUTHORITY\\\\SYSTEM\")\n| extend Time = TimeGenerated\n| project Time, Operation, UserId, ClientIP, OfficeObjectId, Type\n//MITRE",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  [

                                                                                                           ],
                                                                                   "groupByCustomDetails":  [

                                                                                                            ]
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "AadUserId",
                                                                            "columnName":  "UserId"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "IP",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Address",
                                                                            "columnName":  "ClientIP"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "DefenseEvasion",
                                       "Persistence",
                                       "PrivilegeEscalation"
                                   ],
                       "techniques":  [
                                          "T1556",
                                          "T1078",
                                          "T1550"
                                      ],
                       "displayName":  "BAH_TCG-OWADefaultMailboxPolicy",
                       "enabled":  true,
                       "description":  "This rule is focused on monitoring changes or deletions of a default OWA (Outlook Web App) mailbox policy that is configured for the entire tenant. This policy permits or restricts specific functions within Outlook Web App. The purpose of this analytic is to detect and alert on any events where the default OWA mailbox policy is altered or removed. False Positives: This rule can generate alerts for legitimate activity, as changes to the default OWA mailbox policy should rarely occur. However, any alert should be investigated to confirm its validity.\nPLATFORM:Microsoft 365\nMITRE:TA0003;T1078;T1078.004,TA0004;T1078;T1078.004,TA0005;T1078;T1078.004;T1550;T1550.001;T1550.004;T1556;T1556.006;T1556.007",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:15:20.8124079Z"
                   }
}
