{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/DoD365-LAW-RG2/providers/Microsoft.OperationalInsights/workspaces/DOD365-LAW/providers/Microsoft.SecurityInsights/alertRules/04433ccf-e512-44a9-85ed-69d36f049560",
    "name":  "04433ccf-e512-44a9-85ed-69d36f049560",
    "etag":  "\"bc0095fc-0000-2700-0000-653a6a4d0000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT1H",
                       "queryPeriod":  "PT1H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "Medium",
                       "query":  "//Title: BAH_Defender-Windows_Store_Apps\n//Author: Michael Gibbs, Steven Wan\n//Description: Detects on Windows Store application installation attempts through usage of the \u0027winget\u0027 command. Previously this analytic was purposed to detect on any or all installations of applications through the Windows store for any false positives or legitimate hits. This will be able to detect on attempts through either Microsoft Store via cmd or PS.\n//False Positives: Not applicable at this time.\n\nDeviceProcessEvents\n| where ((ProcessCommandLine contains \"winget\"\nand ProcessCommandLine contains \"install\" \nand ProcessCommandLine contains @\"--source=msstore\") // store to download microsoft apps for cmd\nor (ProcessCommandLine contains \"AppxPackage\" \nand ProcessCommandLine contains @\"Microsoft.WindowsStore\" // store to download microsoft apps for PS\nand ProcessCommandLine !contains @\"Remove-AppxPackage\")) // removing apps is not a concern\n| project TimeGenerated, AccountUpn, MachineGroup, DeviceName, InitiatingProcessAccountName, InitiatingProcessAccountDomain, FolderPath, SHA1",
                       "suppressionDuration":  "PT1H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  true,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5M",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  null,
                                                                                   "groupByCustomDetails":  null
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "InitiatingProcessAccountName"
                                                                        },
                                                                        {
                                                                            "identifier":  "NTDomain",
                                                                            "columnName":  "InitiatingProcessAccountDomain"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "Host",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "HostName",
                                                                            "columnName":  "DeviceName"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "FileHash",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Value",
                                                                            "columnName":  "SHA1"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "tactics":  [
                                       "DefenseEvasion"
                                   ],
                       "techniques":  [
                                          "T0820"
                                      ],
                       "displayName":  "BAH_Defender-Windows_Store_Apps",
                       "enabled":  true,
                       "description":  "Detects on Windows Store application installation attempts through usage of the \u0027winget\u0027 command. Previously this analytic was purposed to detect on any or all installations of applications through the Windows store for any false positives or legitimate hits. This will be able to detect on attempts through either Microsoft Store via cmd or PS.",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2023-10-26T13:31:57.060738Z"
                   }
}
