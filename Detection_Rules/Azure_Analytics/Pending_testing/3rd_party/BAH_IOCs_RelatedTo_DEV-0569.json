{
    "id":  "/subscriptions/41de2c2e-1ec0-4d1b-b768-edd976cdd8fe/resourceGroups/dod365-law-rg2/providers/Microsoft.OperationalInsights/workspaces/dod365-law/providers/Microsoft.SecurityInsights/alertRules/f8f7fe1f-4163-474e-a3a4-9d9038372168",
    "name":  "f8f7fe1f-4163-474e-a3a4-9d9038372168",
    "etag":  "\"870018d2-0000-2700-0000-66fdc98f0000\"",
    "type":  "Microsoft.SecurityInsights/alertRules",
    "kind":  "Scheduled",
    "properties":  {
                       "queryFrequency":  "PT1H",
                       "queryPeriod":  "PT1H",
                       "triggerOperator":  "GreaterThan",
                       "triggerThreshold":  0,
                       "severity":  "Medium",
                       "query":  "//Reference: https://www.microsoft.com/en-us/security/blog/2022/11/17/dev-0569-finds-new-ways-to-deliver-royal-ransomware-various-payloads/\n//Title: BAH_IOCs_RelatedTo_DEV-0569\n//Description: This analytic looks for IOCs related to the malicious payload BATLOADER which has been used to deploy the most recent/notable Royal Ransomware (DEV-0569)\n//Author: Steven Wan\n//False Positives: None applicable at this time.\n\nlet hashlist = dynamic([\u002723373654d02cb7eace932609826cca4f82fcac67ca44b9328baba385acc00c67\u0027,\n\u0027f8f3f22425ea72fafba5453c70c299367bd144c95e61b348d1e6dda0c469e219\u0027,\n\u002761e0926120f49b3d5edf3a5e0842b04640911974ecbbc93b6b33ca20c1f981bc\u0027,\n\u002791730741d72584f96ccba99ac9387e09b17be6d64728673871858ea917543c1e\u0027,\n\u0027aef18b7ab1710aaeb0d060127750ba9d17413035309ec74213d538fb1b1bdf79\u0027,\n\u0027e7735cb541e7afd50759eae860b7d1a43d627fbf5cd96d016241084e91659817\u0027,\n\u002723a5981d086242349f6e3476eff11ea3244cebef3d65c76c7bc74470c1ec4b49\u0027,\n\u00273707ad9d9ea318757883ede9691e5c4e8d778c839a056f8b4a94ed47a76da2c8\u0027,\n\u002786f6af51d30159f4d2e00ed733a88dc05cc5dd846b1b2d1ba30582f6e33ac998\u0027,\n\u0027b28047cda1c688c844f676e94770c08cf570f4d65fa4c5e4454ae449c2439e3f\u0027,\n\u0027e1dcc098a6585dbbf4df64f09f8e8508e218485e1958fe6fe04b91547e109a83\u0027,\n\u0027e528cb5e7a2d04269d955ce771b7326bae929355807039f49106126b1a5ff227\u0027,\n\u0027fcbfbc2ae4ed3e51631ecb3184004d96f0a6fd5e9de55400dedfa6b5cafc7c41\u0027\n]);\nlet signInLookup = (\nSigninLogs\n| where TimeGenerated \u003e= ago(1d)\n| where DeviceDetail contains \"displayName\"\n| extend DeviceDetailJson = parse_json(DeviceDetail)\n| extend DeviceNameSI = tostring(DeviceDetailJson.displayName)\n| distinct DeviceNameSI, UserPrincipalName\n);\n(union isfuzzy=True\n    (\n    union withsource=TableName Device* //looks at any table titled \"Device\"\n    | where SHA256 has_any (hashlist)  //checks for any SHA256 in the hashlist\n    | extend SILogDeviceName = toupper((split(DeviceName, \".\"))[0])\n    | join kind=leftouter signInLookup on $left.SILogDeviceName == $right.DeviceNameSI\n    )\n| project TimeGenerated, AccountName, UserPrincipalName, FileName, FileOriginIP, SHA256, MD5, DeviceName\n)",
                       "suppressionDuration":  "PT5H",
                       "suppressionEnabled":  false,
                       "incidentConfiguration":  {
                                                     "createIncident":  false,
                                                     "groupingConfiguration":  {
                                                                                   "enabled":  false,
                                                                                   "reopenClosedIncident":  false,
                                                                                   "lookbackDuration":  "PT5H",
                                                                                   "matchingMethod":  "AllEntities",
                                                                                   "groupByEntities":  [

                                                                                                       ],
                                                                                   "groupByAlertDetails":  [

                                                                                                           ],
                                                                                   "groupByCustomDetails":  [

                                                                                                            ]
                                                                               }
                                                 },
                       "entityMappings":  [
                                              {
                                                  "entityType":  "Account",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "AccountName"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "FileHash",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "Value",
                                                                            "columnName":  "SHA256"
                                                                        }
                                                                    ]
                                              },
                                              {
                                                  "entityType":  "Host",
                                                  "fieldMappings":  [
                                                                        {
                                                                            "identifier":  "FullName",
                                                                            "columnName":  "DeviceName"
                                                                        }
                                                                    ]
                                              }
                                          ],
                       "eventGroupingSettings":  {
                                                     "aggregationKind":  "SingleAlert"
                                                 },
                       "tactics":  [
                                       "InitialAccess"
                                   ],
                       "techniques":  [
                                          "T1566"
                                      ],
                       "displayName":  "BAH_IOCs_RelatedTo_DEV-0569",
                       "enabled":  true,
                       "description":  "This analytic looks for IOCs related to the malicious payload BATLOADER which has been used to deploy the most recent/notable Royal Ransomware (DEV-0569).\nPLATFORM:Microsoft 365,Azure AD,Windows,IaaS\nMITRE:TA0001;T1566",
                       "alertRuleTemplateName":  null,
                       "lastModifiedUtc":  "2024-10-02T22:30:38.4147441Z"
                   }
}
