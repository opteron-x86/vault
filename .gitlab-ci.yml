stages:
  - test
  - export

variables:
  RULES_DIR: sentinel_rules
  OUTPUT_PATH: './$RULES_DIR'

# Stage 1: Test the Environment
test_environment:
  stage: test
  tags:
    - azure
    - powershell
    - cte
  timeout: 15m
  script:
    - echo "Testing PowerShell and CI environment..."
    - |
      pwsh -Command "
      # Verify PowerShell version
      Write-Host 'PowerShell Version:';
      $PSVersionTable.PSVersion;

      # Verify Az module installation
      if (-not (Get-Module -ListAvailable -Name Az)) {
          Write-
